<!DOCTYPE html>
<html>
<head>
<title>djangoæ•™ç¨‹day05.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
	font-size: 14px;
	padding: 0 12px;
	line-height: 22px;
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family:  "Meiryo", "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

</head>
<body>
<h1 id="%E3%80%8Adjango-%E6%95%99%E7%A8%8B%E3%80%8B">ã€ŠDjango æ•™ç¨‹ã€‹</h1>
<ul>
<li>è®²å¸ˆ: é­æ˜æ‹©</li>
<li>æ—¶é—´: 2019</li>
</ul>
<h2 id="%E7%9B%AE%E5%BD%95">ç›®å½•</h2>
<!-- TOC depthFrom:3 depthTo:5 -->
<!-- /TOC -->
<h4 id="%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2">èšåˆæŸ¥è¯¢</h4>
<ul>
<li>èšåˆæŸ¥è¯¢æ˜¯æŒ‡å¯¹ä¸€ä¸ªæ•°æ®è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µçš„æ•°æ®è¿›è¡Œéƒ¨åˆ†æˆ–å…¨éƒ¨è¿›è¡Œç»Ÿè®¡æŸ¥è¯¢,æŸ¥bookstore_bookæ•°æ®è¡¨ä¸­çš„å…¨éƒ¨ä¹¦çš„å¹³å‡ä»·æ ¼ï¼ŒæŸ¥è¯¢æ‰€æœ‰ä¹¦çš„æ€»ä¸ªæ•°ç­‰,éƒ½è¦ä½¿ç”¨èšåˆæŸ¥è¯¢</li>
</ul>
<ol>
<li>ä¸å¸¦åˆ†ç»„èšåˆ
<ul>
<li>ä¸å¸¦åˆ†ç»„çš„èšåˆæŸ¥è¯¢æ˜¯æŒ‡å¯¼å°†å…¨éƒ¨æ•°æ®è¿›è¡Œé›†ä¸­ç»Ÿè®¡æŸ¥è¯¢</li>
<li>èšåˆå‡½æ•°:
<ul>
<li>å®šä¹‰æ¨¡å—: <code>django.db.models</code></li>
<li>ç”¨æ³•: <code>from django.db.models import *</code></li>
<li>èšåˆå‡½æ•°:
<ul>
<li>Sum, Avg, Count, Max, Min</li>
</ul>
</li>
</ul>
</li>
<li>è¯­æ³•:
<ul>
<li>MyModel.objects.aggregate(ç»“æœå˜é‡å=èšåˆå‡½æ•°('åˆ—'))</li>
</ul>
</li>
<li>è¿”å›ç»“æœ:
<ul>
<li>ç”± ç»“æœå˜é‡åå’Œå€¼ç»„æˆçš„å­—å…¸</li>
<li>æ ¼å¼ä¸º:
<ul>
<li>`{&quot;ç»“æœå˜é‡å&quot;: å€¼}</li>
</ul>
</li>
</ul>
</li>
<li>ç¤ºä¾‹:<pre class="hljs"><code><div># å¾—åˆ°æ‰€æœ‰ä¹¦çš„å¹³å‡ä»·æ ¼
from bookstore import models
from django.db.models import Count
result = models.Book.objects.aggregate(myAvg=Avg('price'))
print(&quot;å¹³å‡ä»·æ ¼æ˜¯:&quot;, result['myAvg'])
print(&quot;result=&quot;, result)  # {&quot;myAvg&quot;: 58.2}

# å¾—åˆ°æ•°æ®è¡¨é‡Œæœ‰å¤šå°‘æœ¬ä¹¦
from django.db.models import Count
result = models.Book.objects.aggregate(mycnt=Count('title'))
print(&quot;æ•°æ®è®°å½•æ€»ä¸ªæ•°æ˜¯:&quot;, result['mycnt'])
print(&quot;result=&quot;, result)  # {&quot;mycnt&quot;: 10}

</div></code></pre>
</li>
</ul>
</li>
<li>åˆ†ç»„èšåˆ
<ul>
<li>
<p>åˆ†ç»„èšåˆæ˜¯æŒ‡é€šè¿‡è®¡ç®—æŸ¥è¯¢ç»“æœä¸­æ¯ä¸€ä¸ªå¯¹è±¡æ‰€å…³è”çš„å¯¹è±¡é›†åˆï¼Œä»è€Œå¾—å‡ºæ€»è®¡å€¼(ä¹Ÿå¯ä»¥æ˜¯å¹³å‡å€¼æˆ–æ€»å’Œ)ï¼Œå³ä¸ºæŸ¥è¯¢é›†çš„æ¯ä¸€é¡¹ç”Ÿæˆèšåˆã€‚</p>
</li>
<li>
<p>è¯­æ³•:</p>
<ul>
<li>QuerySet.annotate(ç»“æœå˜é‡å=èšåˆå‡½æ•°('åˆ—'))</li>
</ul>
</li>
<li>
<p>ç”¨æ³•æ­¥éª¤:</p>
<ol>
<li>é€šè¿‡å…ˆç”¨æŸ¥è¯¢ç»“æœMyModel.objects.value. æŸ¥æ‰¾æŸ¥è¯¢è¦åˆ†ç»„èšåˆçš„åˆ—
<ul>
<li>MyModel.objects.value('åˆ—1', 'åˆ—2')</li>
<li>å¦‚:<pre class="hljs"><code><div>pub_set = models.Book.objects.values(<span class="hljs-string">'pub'</span>)
print(books)  <span class="hljs-comment"># &lt;QuerySet [{'pub': 'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'}, {'pub': 'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'}, {'pub_hou {'pub': 'æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾'}, {'pub': 'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'}]&gt;</span>

</div></code></pre>
</li>
</ul>
</li>
<li>é€šè¿‡è¿”å›ç»“æœçš„ QuerySet.annotate æ–¹æ³•åˆ†ç»„èšåˆå¾—åˆ°åˆ†ç»„ç»“æœ
<ul>
<li>QuerySet.annotate(å=èšåˆå‡½æ•°('åˆ—'))</li>
<li>è¿”å› QuerySet ç»“æœé›†,å†…éƒ¨å­˜å‚¨ç»“æœçš„å­—å…¸</li>
<li>å¦‚:<pre class="hljs"><code><div>pub_count_set = pub_set.annotate(myCount=Count('pub'))
print(pub_count_set)  # &lt;QuerySet [{'pub': 'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾', 'myCount': 7}, {'pub': 'æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾', 'myCount': 3}]&gt;
</div></code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>.values('æŸ¥è¯¢åˆ—å')</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹:</p>
<ul>
<li>å¾—åˆ°å“ªå„¿ä¸ªå‡ºç‰ˆç¤¾å…±å‡ºç‰ˆå¤šå°‘æœ¬ä¹¦</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_annotate</span><span class="hljs-params">(request)</span>:</span>
   - <span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Count
    <span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> models

    <span class="hljs-comment"># å¾—åˆ°æ‰€æœ‰å‡ºç‰ˆç¤¾çš„æŸ¥è¯¢é›†åˆQuerySet</span>
    pub_set = models.Book.objects.values(<span class="hljs-string">'pub'</span>)
    <span class="hljs-comment"># æ ¹æ®å‡ºç‰ˆç¤¾æŸ¥è¯¢åˆ†ç»„ï¼Œå‡ºç‰ˆç¤¾å’ŒCountçš„åˆ†ç»„èšåˆæŸ¥è¯¢é›†åˆ</span>
    pub_count_set = pub_set.annotate(myCount=Count(<span class="hljs-string">'pub'</span>))  <span class="hljs-comment"># è¿”å›æŸ¥è¯¢é›†åˆ</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> pub_count_set:
        print(<span class="hljs-string">"å‡ºç‰ˆç¤¾:"</span>, item[<span class="hljs-string">'pub'</span>], <span class="hljs-string">"å›¾ä¹¦æœ‰ï¼š"</span>, item[<span class="hljs-string">'myCount'</span>])
    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">'è¯·æŸ¥çœ‹æœåŠ¡å™¨ç«¯æ§åˆ¶å°è·å–ç»“æœ'</span>)
</div></code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="f%E5%AF%B9%E8%B1%A1">Få¯¹è±¡</h4>
<ul>
<li>ä¸€ä¸ªFå¯¹è±¡ä»£è¡¨æ•°æ®åº“ä¸­æŸä¸ªå­—æ®µçš„ä¿¡æ¯</li>
<li>Få¯¹è±¡é€šå¸¸æ˜¯å¯¹æ•°æ®åº“ä¸­çš„å­—æ®µå€¼åœ¨ä¸åŠ è½½åˆ°å†…å­˜ä¸­çš„æƒ…å†µä¸‹ç›´æ¥åœ¨æ•°æ®åº“æœåŠ¡å™¨ç«¯è¿›è¡Œæ“ä½œ</li>
<li>Få¯¹è±¡åœ¨ æ•°æ®åŒ… django.db.models ä¸­.ä½¿ç”¨æ—¶éœ€è¦é€šè¿‡å¦‚ä¸‹è¯­å¥è¿›è¡ŒåŠ è½½
<ul>
<li><code>from django.db.models import F</code></li>
</ul>
</li>
</ul>
<ol>
<li>
<p>ä½œç”¨:</p>
<ul>
<li>ç”¨äºç±»å±æ€§(å­—æ®µ)ä¹‹é—´çš„æ¯”è¾ƒã€‚</li>
<li>å½“åŒæ—¶å¯¹æ•°æ®åº“ä¸­ä¸¤ä¸ªå­—æ®µçš„å€¼è¿›è¡Œæ¯”è¾ƒè·å– QuerySet æ•°æ®é›†æ—¶ï¼Œå¯ä»¥ä¾¿ç”¨Få¯¹è±¡</li>
</ul>
</li>
<li>
<p>è¯´æ˜:</p>
<ul>
<li>ä¸€ä¸ª F() å¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªmodelçš„å­—æ®µçš„å€¼</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨å®ƒå°±å¯ä»¥ç›´æ¥å‚è€ƒmodelçš„fieldå’Œæ‰§è¡Œæ•°æ®åº“æ“ä½œè€Œä¸ç”¨å†æŠŠå®ƒä»¬ï¼ˆmodel fieldï¼‰æŸ¥è¯¢å‡ºæ¥æ”¾åˆ°pythonå†…å­˜ä¸­ã€‚</p>
</li>
<li>
<p>è¯­æ³•:</p>
<pre class="hljs"><code><div>from django.db.models import F
F('åˆ—å')
</div></code></pre>
</li>
<li>
<p>ç¤ºä¾‹1</p>
<ul>
<li>æ›´æ–°Bookå®ä¾‹ä¸­æ‰€æœ‰çš„é›¶å”®ä»·æ¶¨10å…ƒ</li>
</ul>
<pre class="hljs"><code><div>models.Book.objects.all().update(market_price=F('market_price')+10)
# ä»¥ä¸‹åšæ³•å¥½äºå¦‚ä¸‹ä»£ç 
books = models.Book.objects.all()
for book in books:
    book.update(market_price=book.marget_price+10)
    book.save()
</div></code></pre>
</li>
<li>
<p>ç¤ºä¾‹2</p>
<ul>
<li>å¯¹æ•°æ®åº“ä¸­ä¸¤ä¸ªå­—æ®µçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œåˆ—å‡ºå“ªå„¿äº›ä¹¦çš„é›¶å”®ä»·é«˜äºå®šä»·?</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> F
<span class="hljs-keyword">from</span> bookstore <span class="hljs-keyword">import</span> models
books = models.Book.objects.filter(market_price__gt=F(<span class="hljs-string">'price'</span>))
<span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:
    print(book.title, <span class="hljs-string">'å®šä»·:'</span>, book.price, <span class="hljs-string">'ç°ä»·:'</span>, book.market_price)
</div></code></pre>
</li>
</ol>
<h4 id="q%E5%AF%B9%E8%B1%A1---q">Qå¯¹è±¡ - Q()</h4>
<ul>
<li>å½“åœ¨è·å–æŸ¥è¯¢ç»“æœé›† ä½¿ç”¨å¤æ‚çš„é€»è¾‘æˆ–  <code>|</code> ã€ é€»è¾‘é <code>~</code> ç­‰æ“ä½œæ—¶å¯ä»¥å€ŸåŠ©äº Qå¯¹è±¡è¿›è¡Œæ“ä½œ</li>
<li>å¦‚: æƒ³æ‰¾å‡ºå®šä»·ä½äº20å…ƒ æˆ– æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾çš„å…¨éƒ¨ä¹¦ï¼Œå¯ä»¥å†™æˆ<pre class="hljs"><code><div>models.Book.objects.filter(Q(price__lt=20)|Q(pub=&quot;æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾&quot;))
</div></code></pre>
</li>
<li>Qå¯¹è±¡åœ¨ æ•°æ®åŒ… django.db.models ä¸­ã€‚éœ€è¦å…ˆå¯¼å…¥å†ä½¿ç”¨
<ul>
<li><code>from django.db.models import Q</code></li>
</ul>
</li>
</ul>
<ol>
<li>ä½œç”¨
<ul>
<li>åœ¨æ¡ä»¶ä¸­ç”¨æ¥å®ç°é™¤ and(&amp;) ä»¥å¤–çš„ or(|) æˆ– not(~) æ“ä½œ</li>
</ul>
</li>
<li>è¿ç®—ç¬¦:
<ul>
<li>&amp; ä¸æ“ä½œ</li>
<li>| æˆ–æ“ä½œ</li>
<li>ã€œ éæ“ä½œ</li>
</ul>
</li>
<li>è¯­æ³•<pre class="hljs"><code><div>from django.db.models import Q
Q(æ¡ä»¶1)|Q(æ¡ä»¶2)  # æ¡ä»¶1æˆç«‹æˆ–æ¡ä»¶2æˆç«‹
Q(æ¡ä»¶1)&amp;Q(æ¡ä»¶2)  # æ¡ä»¶1å’Œæ¡ä»¶2åŒæ—¶æˆç«‹
Q(æ¡ä»¶1)&amp;~Q(æ¡ä»¶2)  # æ¡ä»¶1æˆç«‹ä¸”æ¡ä»¶2ä¸æˆç«‹
...
</div></code></pre>
</li>
<li>ç¤ºä¾‹<pre class="hljs"><code><div><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q
<span class="hljs-comment"># æŸ¥æ‰¾æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾çš„ä¹¦æˆ–ä»·æ ¼ä½äº50çš„ä¹¦</span>
models.Book.objects.filter(Q(market_price__lt=<span class="hljs-number">50</span>) | Q(pub_house=<span class="hljs-string">'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'</span>))
<span class="hljs-comment"># æŸ¥æ‰¾ä¸æ˜¯æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾çš„ä¹¦ä¸”ä»·æ ¼ä½äº50çš„ä¹¦</span>
models.Book.objects.filter(Q(market_price__lt=<span class="hljs-number">50</span>) &amp; ~Q(pub_house=<span class="hljs-string">'æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾'</span>))
</div></code></pre>
</li>
</ol>
<h4 id="%E5%8E%9F%E7%94%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95">åŸç”Ÿçš„æ•°æ®åº“æ“ä½œæ–¹æ³•</h4>
<h5 id="%E4%BD%BF%E7%94%A8mymodelobjectsraw%E8%BF%9B%E8%A1%8C-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E6%9F%A5%E8%AF%A2">ä½¿ç”¨MyModel.objects.raw()è¿›è¡Œ æ•°æ®åº“æŸ¥è¯¢æ“ä½œæŸ¥è¯¢</h5>
<ul>
<li>åœ¨djangoä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å‹ç®¡ç†å™¨çš„rawæ–¹æ³•æ¥æ‰§è¡Œselectè¯­å¥è¿›è¡Œæ•°æ®æŸ¥è¯¢</li>
</ul>
<ol>
<li>è¯­æ³•:
<ul>
<li><code>MyModel.objects.raw(sqlè¯­å¥)</code></li>
</ul>
</li>
<li>ç”¨æ³•
<ul>
<li><code>MyModel.objects.raw('sqlè¯­å¥')</code></li>
</ul>
</li>
<li>è¿”å›å€¼:
<ul>
<li>QuerySet é›†åˆå¯¹è±¡</li>
</ul>
</li>
<li>ç¤ºä¾‹<pre class="hljs"><code><div>books = models.Book.objects.raw(<span class="hljs-string">'select * from bookstore_book'</span>)

<span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:
    print(book)
</div></code></pre>
</li>
</ol>
<h5 id="%E4%BD%BF%E7%94%A8django%E4%B8%AD%E7%9A%84%E6%B8%B8%E6%A0%87cursor%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%93%8D%E4%BD%9C">ä½¿ç”¨djangoä¸­çš„æ¸¸æ ‡cursorå¯¹æ•°æ®åº“è¿›è¡Œ å¢åˆ æ”¹æ“ä½œ</h5>
<ul>
<li>
<p>åœ¨Djangoä¸­å¯ä»¥ä½¿ç”¨ å¦‚UPDATE,DELETEç­‰SQLè¯­å¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚</p>
</li>
<li>
<p>åœ¨DJaogoä¸­ä½¿ç”¨ä¸Šè¿°éæŸ¥è¯¢è¯­å¥å¿…é¡»ä½¿ç”¨æ¸¸æ ‡è¿›è¡Œæ“ä½œ</p>
</li>
<li>
<p>ä½¿ç”¨æ­¥éª¤:</p>
<ol>
<li>å¯¼å…¥cursoræ‰€åœ¨çš„åŒ…
<ul>
<li>Djangoä¸­çš„æ¸¸æ ‡cursorå®šä¹‰åœ¨ django.db.connectionåŒ…ä¸­ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆå¯¼å…¥</li>
<li>å¦‚ï¼š
<ul>
<li><code>from django.db import connection</code></li>
</ul>
</li>
</ul>
</li>
<li>ç”¨åˆ›å»ºcursorç±»çš„æ„é€ å‡½æ•°åˆ›å»ºcursorå¯¹è±¡ï¼Œå†ä½¿ç”¨cursorå¯¹è±¡,ä¸ºä¿è¯åœ¨å‡ºç°å¼‚å¸¸æ—¶èƒ½é‡Šæ”¾cursorèµ„æº,é€šå¸¸ä½¿ç”¨withè¯­å¥è¿›è¡Œåˆ›å»ºæ“ä½œ
<ul>
<li>å¦‚:<pre class="hljs"><code><div><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection
<span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cur:
    cur.execute(<span class="hljs-string">'æ‰§è¡ŒSQLè¯­å¥'</span>)
</div></code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>ç¤ºä¾‹<pre class="hljs"><code><div><span class="hljs-comment"># ç”¨SQLè¯­å¥å°†id ä¸º 10çš„ ä¹¦çš„å‡ºç‰ˆç¤¾æ”¹ä¸º "XXXå‡ºç‰ˆç¤¾"</span>
<span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection
<span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cur: 
    cur.execute(<span class="hljs-string">'update bookstore_book set pub_house="XXXå‡ºç‰ˆç¤¾" where id=10;'</span>)

<span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cur:
    <span class="hljs-comment"># åˆ é™¤ idä¸º1çš„ä¸€æ¡è®°å½•</span>
    cur.execute(<span class="hljs-string">'delete from bookstore_book where id=10;'</span>)
</div></code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="admin-%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86">admin åå°æ•°æ®åº“ç®¡ç†</h3>
<ul>
<li>django æä¾›äº†æ¯”è¾ƒå®Œå–„çš„åå°ç®¡ç†æ•°æ®åº“çš„æ¥å£ï¼Œå¯ä¾›å¼€å‘è¿‡ç¨‹ä¸­è°ƒç”¨å’Œæµ‹è¯•ä½¿ç”¨</li>
<li>django ä¼šæœé›†æ‰€æœ‰å·²æ³¨å†Œçš„æ¨¡å‹ç±»ï¼Œä¸ºè¿™äº›æ¨¡å‹ç±»ææ‹±æ•°æ®ç®¡ç†ç•Œé¢ï¼Œä¾›å¼€å‘è€…ä½¿ç”¨</li>
<li>ä½¿ç”¨æ­¥éª¤:
<ol>
<li>åˆ›å»ºåå°ç®¡ç†å¸å·:
<ul>
<li>åå°ç®¡ç†--åˆ›å»ºç®¡ç†å‘˜å¸å·
<ul>
<li><code>$ python3 manage.py createsuperuser</code></li>
<li>æ ¹æ®æç¤ºå®Œæˆæ³¨å†Œ,å‚è€ƒå¦‚ä¸‹:</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-meta">$</span><span class="bash"> python3 manage.py createsuperuser</span>
Username (leave blank to use 'tarena'): tarena  # æ­¤å¤„è¾“å…¥ç”¨æˆ·å
Email address: weimz@tedu.cn  # æ­¤å¤„è¾“å…¥é‚®ç®±
Password: # æ­¤å¤„è¾“å…¥å¯†ç (å¯†ç è¦å¤æ‚äº›ï¼Œå¦åˆ™ä¼šæç¤ºå¯†ç å¤ªç®€å•)
Password (again): # å†æ¬¡è¾“å…¥é‡å¤å¯†ç 
Superuser created successfully.
<span class="hljs-meta">$</span><span class="bash"> </span>
</div></code></pre>
</li>
</ul>
</li>
<li>ç”¨æ³¨å†Œçš„å¸å·ç™»é™†åå°ç®¡ç†ç•Œé¢
<ul>
<li>åå°ç®¡ç†çš„ç™»å½•åœ°å€:
<ul>
<li><a href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E8%A1%A8">è‡ªå®šä¹‰åå°ç®¡ç†æ•°æ®è¡¨</h4>
<ul>
<li>è‹¥è¦è‡ªå·±å®šä¹‰çš„æ¨¡å‹ç±»ä¹Ÿèƒ½åœ¨ <code>/admin</code> åå°ç®¡ç†ç•Œä¸­æ˜¾ç¤ºå’Œç®¡ç†ï¼Œéœ€è¦å°†è‡ªå·±çš„ç±»æ³¨å†Œåˆ°åå°ç®¡ç†ç•Œé¢</li>
<li>æ·»åŠ è‡ªå·±å®šä¹‰æ¨¡å‹ç±»çš„åå°ç®¡ç†æ•°æ®è¡¨çš„,éœ€è¦ç”¨<code>admin.site.register(è‡ªå®šä¹‰æ¨¡å‹ç±»)</code> æ–¹æ³•è¿›è¡Œæ³¨å†Œ
<ul>
<li>é…ç½®æ­¥éª¤å¦‚ä¸‹:
<ol>
<li>åœ¨åº”ç”¨appä¸­çš„admin.pyä¸­å¯¼å…¥æ³¨å†Œè¦ç®¡ç†çš„æ¨¡å‹modelsç±», å¦‚:<pre class="hljs"><code><div>from . import models
</div></code></pre>
</li>
<li>è°ƒç”¨ admin.site.register æ–¹æ³•è¿›è¡Œæ³¨å†Œ,å¦‚:<pre class="hljs"><code><div>from django.contrib import admin
admin.site.register(è‡ªå®šä¹‰æ¨¡å‹ç±»)
</div></code></pre>
</li>
</ol>
</li>
<li>å¦‚: åœ¨ bookstore/admin.py æ·»åŠ å¦‚ä¸‹ä»£ç å¯¹Bookç±»è¿›è¡Œç®¡ç†</li>
<li>ç¤ºä¾‹:<pre class="hljs"><code><div><span class="hljs-comment"># file: bookstore/admin.py</span>
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-comment"># Register your models here.</span>

<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> models
...
admin.site.register(models.Book)  <span class="hljs-comment"># å°†Bookç±»æ³¨å†Œä¸ºå¯ç®¡ç†é¡µé¢</span>
</div></code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="%E4%BF%AE%E6%94%B9%E5%90%8E%E5%8F%B0models%E7%9A%84%E5%B1%95%E7%8E%B0%E5%BD%A2%E5%BC%8F">ä¿®æ”¹åå°Modelsçš„å±•ç°å½¢å¼</h4>
<ul>
<li>åœ¨adminåå°ç®¡ç†æ•°æ®åº“ä¸­å¯¹è‡ªå®šä¹‰çš„æ•°æ®è®°å½•éƒ½å±•ç¤ºä¸º <code>XXXX object</code> ç±»å‹çš„è®°å½•ï¼Œä¸ä¾¿äºé˜…è¯»å’Œåˆ¤æ–­</li>
<li>åœ¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¨¡å‹ç±»ä¸­å¯ä»¥é‡å†™ <code>def __str__(self):</code> æ–¹æ³•è§£å†³æ˜¾ç¤ºé—®é¢˜,å¦‚:
<ul>
<li>åœ¨ è‡ªå®šä¹‰æ¨¡å‹ç±»ä¸­é‡å†™ <strong>str</strong>(self) æ–¹æ³•è¿”å›æ˜¾ç¤ºæ–‡å­—å†…å®¹:</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span><span class="hljs-params">(models.Model)</span>:</span>
    ...
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¹¦å"</span> + self.title
</div></code></pre>
</li>
</ul>
<h4 id="%E6%A8%A1%E5%9E%8B%E7%AE%A1%E7%90%86%E5%99%A8%E7%B1%BB">æ¨¡å‹ç®¡ç†å™¨ç±»</h4>
<ul>
<li>
<p>ä½œç”¨:</p>
<ul>
<li>ä¸ºåå°ç®¡ç†ç•Œé¢æ·»åŠ ä¾¿äºæ“ä½œçš„æ–°åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li>
<p>è¯´æ˜:</p>
<ul>
<li>åå°ç®¡ç†å™¨ç±»é¡»ç»§æ‰¿è‡ª <code>django.contrib.admin</code> é‡Œçš„ <code>ModelAdmin</code> ç±»</li>
</ul>
</li>
<li>
<p>æ¨¡å‹ç®¡ç†å™¨çš„ä½¿ç”¨æ–¹æ³•:</p>
<ol>
<li>åœ¨ <code>&lt;åº”ç”¨app&gt;/admin.py</code> é‡Œå®šä¹‰æ¨¡å‹ç®¡ç†å™¨ç±»<pre class="hljs"><code><div>class XXXX_Manager(admin.ModelAdmin):
    ......
</div></code></pre>
</li>
<li>æ³¨å†Œç®¡ç†å™¨ä¸æ¨¡å‹ç±»å…³è”<pre class="hljs"><code><div>from django.contrib import admin
from . import models
admin.site.register(models.YYYY, XXXX_Manager) # æ³¨å†Œmodels.YYYY æ¨¡å‹ç±»ä¸ ç®¡ç†å™¨ç±» XXXX_Manager å…³è”
</div></code></pre>
</li>
</ol>
<ul>
<li>ç¤ºä¾‹:<pre class="hljs"><code><div># file : bookstore/admin.py
from django.contrib import admin
from . import models

class BookAdmin(admin.ModelAdmin):
    list_display = ['id', 'title', 'price', 'market_price']

admin.site.register(models.Book, BookAdmin)
</div></code></pre>
<ul>
<li>è¿›å…¥<a href="http://127.0.0.1:8000/admin/bookstore/book/">http://127.0.0.1:8000/admin/bookstore/book/</a> æŸ¥çœ‹æ˜¾ç¤ºæ–¹å¼å’Œä»¥å‰æœ‰æ‰€ä¸åŒ</li>
</ul>
</li>
</ul>
</li>
<li>
<p>æ¨¡å‹ç®¡ç†å™¨ç±»ModelAdminä¸­å®ç°çš„é«˜çº§ç®¡ç†åŠŸèƒ½</p>
<ol>
<li>list_display å»æ§åˆ¶å“ªäº›å­—æ®µä¼šæ˜¾ç¤ºåœ¨Admin çš„ä¿®æ”¹åˆ—è¡¨é¡µé¢ä¸­ã€‚</li>
<li>list_display_links å¯ä»¥æ§åˆ¶list_displayä¸­çš„å­—æ®µæ˜¯å¦åº”è¯¥é“¾æ¥åˆ°å¯¹è±¡çš„â€œæ›´æ”¹â€é¡µé¢ã€‚</li>
<li>list_filter è®¾ç½®æ¿€æ´»Admin ä¿®æ”¹åˆ—è¡¨é¡µé¢å³ä¾§æ ä¸­çš„è¿‡æ»¤å™¨</li>
<li>search_fields è®¾ç½®å¯ç”¨Admin æ›´æ”¹åˆ—è¡¨é¡µé¢ä¸Šçš„æœç´¢æ¡†ã€‚</li>
<li>list_editable è®¾ç½®ä¸ºæ¨¡å‹ä¸Šçš„å­—æ®µåç§°åˆ—è¡¨ï¼Œè¿™å°†å…è®¸åœ¨æ›´æ”¹åˆ—è¡¨é¡µé¢ä¸Šè¿›è¡Œç¼–è¾‘ã€‚</li>
<li>å…¶å®ƒå‚è§<a href="https://docs.djangoproject.com/en/1.11/ref/contrib/admin/">https://docs.djangoproject.com/en/1.11/ref/contrib/admin/</a></li>
</ol>
</li>
</ul>
<h4 id="%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%AE%A1%E7%90%86">æ•°æ®åº“è¡¨ç®¡ç†</h4>
<ol>
<li>ä¿®æ”¹æ¨¡å‹ç±»å­—æ®µçš„æ˜¾ç¤ºåå­—
<ul>
<li>æ¨¡å‹ç±»å„å­—æ®µçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º verbose_name,æ­¤å­—æ®µæ˜¾ç¤ºçš„åå­—ä¼šåœ¨åå°æ•°æ®åº“ç®¡ç†é¡µé¢æ˜¾ç¤º</li>
<li>é€šè¿‡ verbose_name å­—æ®µé€‰é¡¹,ä¿®æ”¹æ˜¾ç¤ºåç§°ç¤ºä¾‹å¦‚ä¸‹ï¼š<pre class="hljs"><code><div>title = models.CharField(
    max_length = <span class="hljs-number">30</span>,
    verbose_name=<span class="hljs-string">'æ˜¾ç¤ºåç§°'</span>
)
</div></code></pre>
</li>
</ul>
</li>
<li>é€šè¿‡Metaå†…åµŒç±» å®šä¹‰æ¨¡å‹ç±»çš„å±æ€§åŠå±•ç°å½¢å¼
<ul>
<li>æ¨¡å‹ç±»å¯ä»¥é€šè¿‡å®šä¹‰å†…éƒ¨ç±»class Meta æ¥é‡æ–°å®šä¹‰å½“å‰æ¨¡å‹ç±»å’Œæ•°æ®è¡¨çš„ä¸€äº›å±æ€§ä¿¡æ¯</li>
<li>ç”¨æ³•æ ¼å¼å¦‚ä¸‹:<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span><span class="hljs-params">(models.Model)</span>:</span>
    title = CharField(....)
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        <span class="hljs-number">1.</span> db_table = <span class="hljs-string">'æ•°æ®è¡¨å'</span>
            - è¯¥æ¨¡å‹æ‰€ç”¨çš„æ•°æ®è¡¨çš„åç§°ã€‚(è®¾ç½®å®Œæˆåéœ€è¦ç«‹é©¬æ›´æ–°åŒæ­¥æ•°æ®åº“)
        <span class="hljs-number">2.</span> verbose_name = <span class="hljs-string">'å•æ•°å'</span>
            - ç»™æ¨¡å‹å¯¹è±¡çš„ä¸€ä¸ªæ˜“äºç†è§£çš„åç§°(å•æ•°),ç”¨äºæ˜¾ç¤ºåœ¨/adminç®¡ç†ç•Œé¢ä¸­
        <span class="hljs-number">3.</span> verbose_name_plural = <span class="hljs-string">'å¤æ•°å'</span>
            - è¯¥å¯¹è±¡å¤æ•°å½¢å¼çš„åç§°(å¤æ•°),ç”¨äºæ˜¾ç¤ºåœ¨/adminç®¡ç†ç•Œé¢ä¸­
</div></code></pre>
</li>
<li>ç¤ºä¾‹:<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
    db_table = <span class="hljs-string">'book_table'</span>  <span class="hljs-comment"># å°†åŸæ•°æ®è¡¨å"bookstore_book" æ¢ä¸º "book_table",è¯·æŸ¥çœ‹æ•°æ®è¡¨</span>
    verbose_name = <span class="hljs-string">'booooook'</span>
    verbose_name_plural = <span class="hljs-string">'booksssssss'</span>  <span class="hljs-comment"># å»127.0.0.1:8000/adminä¸‹çœ‹çœ‹å“ªå„¿å˜åŒ–äº†?</span>
</div></code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>ç»ƒä¹ :
<ul>
<li>å°†Bookæ¨¡å‹ç±» å’Œ Author æ¨¡å‹ç±»éƒ½åŠ å…¥åå°ç®¡ç†</li>
<li>åˆ¶ä½œä¸€ä¸ªAuthorManagerç®¡ç†å™¨ç±»ï¼Œè®©åå°ç®¡ç†Authorsåˆ—è¡¨ä¸­æ˜¾ç¤ºä½œè€…çš„IDã€å§“åã€å¹´é¾„ä¿¡æ¯</li>
<li>ç”¨åå°ç®¡ç†ç¨‹åº æ·»åŠ ä¸‰æ¡ Author è®°å½•</li>
<li>ä¿®æ”¹å…¶ä¸­ä¸€æ¡è®°å½•çš„å¹´é¾„</li>
<li>åˆ é™¤æœ€åä¸€æ¡æ·»åŠ çš„è®°å½•</li>
<li>å°†bookstore_author æ•°åè¡¨åç§°æ”¹ä¸ºmyauthor (éœ€è¦é‡æ–°è¿ç§»æ•°æ®åº“)</li>
</ul>
</li>
</ul>
<!-- 
```
ç»ƒä¹ :
    1.ä¿®æ”¹ Publisher çš„åå°æ˜¾ç¤º
        1.æ›´æ”¹è¡¨åä¸º publisher
        2.ä¿®æ”¹åå°å±•ç¤ºåç§°ä¸º - å‡ºç‰ˆç¤¾
        3.ä¿®æ”¹æ¯ä¸ªå±æ€§å¯¹åº”çš„ä¸­æ–‡å
    2.ä¿®æ”¹ Book åå°æ˜¾ç¤º
        1.æ›´æ”¹è¡¨åä¸º book
        2.ä¿®æ”¹åå°å±•ç¤ºåç§° - ä¹¦ç±
        3.ä¿®æ”¹æ¯ä¸ªå±æ€§å¯¹åº”çš„ä¸­æ–‡å 

2.ç»ƒä¹ 
    ä¸º Publisher å¢åŠ é«˜çº§ç®¡ç†åŠŸèƒ½
    1. åœ¨åˆ—è¡¨é¡µä¸­æ˜¾ç¤º name,address,city å±æ€§
    2. åœ¨åˆ—è¡¨é¡µä¸­ address å’Œ city æ˜¯å¯ç¼–è¾‘çš„
    3. å³ä¾§å¢åŠ è¿‡æ»¤å™¨ , å…è®¸æŒ‰ç…§cityç­›é€‰
    4. é¡¶éƒ¨å¢åŠ æœç´¢æ¡†,å…è®¸æŒ‰ç…§nameå’Œwebsiteæœç´¢
    5. è¯¦æƒ…é¡µä¸­åˆ†ç»„æ˜¾ç¤º:
        1.name,address,city åŸºæœ¬ä¿¡æ¯
        2.country,website é«˜çº§ä¿¡æ¯,å¯æŠ˜å 
```
 -->
<h3 id="%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84-relationship-map">æ•°æ®è¡¨å…³è”å…³ç³»æ˜ å°„ Relationship Map</h3>
<ul>
<li>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œé€šå¸¸ä¸ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½æ”¾åœ¨åŒä¸€å¼ è¡¨ä¸­ï¼Œè¿™æ ·åšä¼šé¢å¤–å ç”¨å†…å­˜ç©ºé—´ï¼Œ</li>
<li>åœ¨å…³ç³»åˆ—æ•°æ®åº“ä¸­é€šå¸¸ç”¨è¡¨å…³è”æ¥è§£å†³æ•°æ®åº“ã€‚</li>
<li>å¸¸ç”¨çš„è¡¨å…³è”æ–¹å¼æœ‰ä¸‰ç§:
<ol>
<li>ä¸€å¯¹ä¸€æ˜ å°„
<ul>
<li>å¦‚: ä¸€ä¸ªèº«ä»½è¯å¯¹åº”ä¸€ä¸ªäºº</li>
</ul>
</li>
<li>ä¸€å¯¹å¤šæ˜ å°„
<ul>
<li>å¦‚: ä¸€ä¸ªç­çº§å¯ä»¥æœ‰å¤šä¸ªå­¦ç”Ÿ</li>
</ul>
</li>
<li>å¤šå¯¹å¤šæ˜ å°„
<ul>
<li>å¦‚: ä¸€ä¸ªå­¦ç”Ÿå¯ä»¥æŠ¥å¤šä¸ªè¯¾ç¨‹ï¼Œä¸€ä¸ªè¯¾ç¨‹å¯ä»¥æœ‰å¤šä¸ªå­¦ç”Ÿå­¦ä¹ </li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="%E4%B8%80%E5%AF%B9%E4%B8%80%E6%98%A0%E5%B0%84">ä¸€å¯¹ä¸€æ˜ å°„</h4>
<ul>
<li>ä¸€å¯¹ä¸€æ˜¯è¡¨ç¤ºç°å®äº‹ç‰©é—´å­˜åœ¨çš„ä¸€å¯¹ä¸€çš„å¯¹åº”å…³ç³»ã€‚</li>
<li>å¦‚:ä¸€ä¸ªå®¶åº­åªæœ‰ä¸€ä¸ªæˆ·ä¸»ï¼Œä¸€ä¸ªç”·äººæœ‰ä¸€ä¸ªå¦»å­ï¼Œä¸€ä¸ªäººæœ‰ä¸€ä¸ªå”¯ä¸€çš„æŒ‡çº¹ä¿¡æ¯ç­‰</li>
</ul>
<ol>
<li>è¯­æ³•<pre class="hljs"><code><div>åœ¨å…³è”çš„ä¸¤ä¸ªç±»ä¸­çš„ä»»ä½•ä¸€ä¸ªç±»ä¸­:
class A(model.Model):
    ...

class B(model.Model):
    å±æ€§ = models.OneToOneField(A)
</div></code></pre>
</li>
<li>ç”¨æ³•ç¤ºä¾‹
<ol>
<li>åˆ›å»ºä½œå®¶å’Œä½œå®¶å¦»å­ç±»<pre class="hljs"><code><div><span class="hljs-comment"># file : xxxxxxxx/models.py</span>
<span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Author</span><span class="hljs-params">(models.Model)</span>:</span>
    <span class="hljs-string">'''ä½œå®¶æ¨¡å‹ç±»'''</span>
    name = models.CharField(<span class="hljs-string">'ä½œå®¶'</span>, max_length=<span class="hljs-number">50</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wife</span><span class="hljs-params">(models.Model)</span>:</span>
    <span class="hljs-string">'''ä½œå®¶å¦»å­æ¨¡å‹ç±»'''</span>
    name = models.CharField(<span class="hljs-string">"å¦»å­"</span>, max_length=<span class="hljs-number">50</span>)
    author = models.OneToOneField(Author)  <span class="hljs-comment"># å¢åŠ ä¸€å¯¹ä¸€å±æ€§</span>
</div></code></pre>
</li>
<li>æŸ¥è¯¢
<ul>
<li>åœ¨ Wife å¯¹è±¡ä¸­,é€šè¿‡ author å±æ€§æ‰¾åˆ°å¯¹åº”çš„authorå¯¹è±¡</li>
<li>åœ¨ Author å¯¹è±¡ä¸­,é€šè¿‡ wife å±æ€§æ‰¾åˆ°å¯¹åº”çš„wifeå¯¹è±¡</li>
</ul>
</li>
<li>åˆ›å§‹ä¸€å¯¹ä¸€çš„æ•°æ®è®°å½•<pre class="hljs"><code><div><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> models
author1 = models.Author.objects.create(name=<span class="hljs-string">'ç‹è€å¸ˆ'</span>)
wife1 = models.Wife.objects.create(name=<span class="hljs-string">'ç‹å¤«äºº'</span>, author=author1)  <span class="hljs-comment"># å…³è”ç‹è€å¸ˆ</span>
author2 = models.Author.objects.create(name=<span class="hljs-string">'å°æ³½è€å¸ˆ'</span>)  <span class="hljs-comment"># ä¸€å¯¹ä¸€å¯ä»¥æ²¡æœ‰æ•°æ®å¯¹åº”çš„æ•°æ® </span>
</div></code></pre>
</li>
<li>ä¸€å¯¹ä¸€æ•°æ®çš„ç›¸äº’è·å–
<ol>
<li>æ­£å‘æŸ¥è¯¢
<ul>
<li>ç›´æ¥é€šè¿‡å…³è”å±æ€§æŸ¥è¯¢å³å¯</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># é€šè¿‡ wife æ‰¾ author</span>
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> models
wife = models.Wife.objects.get(name=<span class="hljs-string">'ç‹å¤«äºº'</span>)
print(wife.name, <span class="hljs-string">'çš„è€å…¬æ˜¯'</span>, wife.author.name)
</div></code></pre>
</li>
<li>åå‘æŸ¥è¯¢
<ul>
<li>é€šè¿‡åå‘å¼•ç”¨å±æ€§æŸ¥è¯¢</li>
<li>åå‘å¼•ç”¨å±æ€§ä¸º<code>å®ä¾‹å¯¹è±¡.å¼•ç”¨ç±»å(å°å†™)</code>ï¼Œå¦‚ä½œå®¶çš„åå‘å¼•ç”¨ä¸º<code>ä½œå®¶å¯¹è±¡.wife</code></li>
<li>å½“åå‘å¼•ç”¨ä¸å­˜åœ¨æ—¶ï¼Œåˆ™ä¼šè§¦å‘å¼‚å¸¸</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># é€šè¿‡ author.wife å¼•ç”¨å±æ€§ æ‰¾ wife,å¦‚æœæ²¡æœ‰å¯¹åº”çš„wifeåˆšè§¦å‘å¼‚å¸¸</span>
author1 = models.Author.objects.get(name=<span class="hljs-string">'ç‹è€å¸ˆ'</span>)
print(author1.name, <span class="hljs-string">'çš„å¦»å­æ˜¯'</span>, author1.wife.name)
author2 = models.Author.objects.get(name=<span class="hljs-string">'å°æ³½è€å¸ˆ'</span>)
<span class="hljs-keyword">try</span>:
    print(author2.name, <span class="hljs-string">'çš„å¦»å­æ˜¯'</span>, author2.wife.name)
<span class="hljs-keyword">except</span>:
    print(author2.name, <span class="hljs-string">'è¿˜æ²¡æœ‰å¦»å­'</span>)
</div></code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<ul>
<li>
<p>ä½œç”¨:</p>
<ul>
<li>ä¸»è¦æ˜¯è§£å†³å¸¸ç”¨æ•°æ®ä¸å¸¸ç”¨æ•°æ®çš„å­˜å‚¨é—®é¢˜,æŠŠç»å¸¸åŠ è½½çš„ä¸€ä¸ªæ•°æ®æ”¾åœ¨ä¸»è¡¨ä¸­ï¼Œä¸å¸¸ç”¨æ•°æ®æ”¾åœ¨å¦ä¸€ä¸ªå‰¯è¡¨ä¸­ï¼Œè¿™æ ·åœ¨è®¿é—®ä¸»è¡¨æ•°æ®æ—¶ä¸éœ€è¦åŠ è½½å‰¯è¡¨ä¸­çš„æ•°æ®ä»¥æé«˜è®¿é—®é€Ÿåº¦æé«˜æ•ˆç‡å’ŒèŠ‚çœå†…å­˜ç©ºé—´,å¦‚ç»å¸¸æŠŠä¹¦çš„å†…å®¹å’Œä¹¦åå»ºæˆä¸¤å¼ è¡¨ï¼Œå› ä¸ºåœ¨ç½‘ç«™ä¸Šç»å¸¸è®¿é—®ä¹¦åç­‰ä¿¡æ¯ï¼Œä½†ä¸éœ€è¦å¾—åˆ°ä¹¦çš„å†…å®¹ã€‚</li>
</ul>
</li>
<li>
<p>ç»ƒä¹ :</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªWifeæ¨¡å‹ç±»,å±æ€§å¦‚ä¸‹
<ol>
<li>name</li>
<li>age</li>
</ol>
</li>
<li>åœ¨Wifeç±»ä¸­å¢åŠ ä¸€å¯¹ä¸€å…³è”å…³ç³»,å¼•ç”¨ Author</li>
<li>åŒæ­¥å›æ•°æ®åº“å¹¶è§‚å¯Ÿç»“æœ</li>
</ol>
</li>
</ul>
<h4 id="%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84">ä¸€å¯¹å¤šæ˜ å°„</h4>
<ul>
<li>ä¸€å¯¹å¤šæ˜¯è¡¨ç¤ºç°å®äº‹ç‰©é—´å­˜åœ¨çš„ä¸€å¯¹å¤šçš„å¯¹åº”å…³ç³»ã€‚</li>
<li>å¦‚:ä¸€ä¸ªå­¦æ ¡æœ‰å¤šä¸ªç­çº§,ä¸€ä¸ªç­çº§æœ‰å¤šä¸ªå­¦ç”Ÿ, ä¸€æœ¬å›¾ä¹¦åªèƒ½å±äºä¸€ä¸ªå‡ºç‰ˆç¤¾,ä¸€ä¸ªå‡ºç‰ˆç¤¾å…è®¸å‡ºç‰ˆå¤šæœ¬å›¾ä¹¦</li>
</ul>
<ol>
<li>
<p>ç”¨æ³•è¯­æ³•</p>
<ul>
<li>å½“ä¸€ä¸ªAç±»å¯¹è±¡å¯ä»¥å…³è”å¤šä¸ªBç±»å¯¹è±¡æ—¶</li>
</ul>
<pre class="hljs"><code><div>class A(model.Model):
    ...

class B(model.Model):
    å±æ€§ = models.ForeignKey(å¤šå¯¹ä¸€ä¸­&quot;ä¸€&quot;çš„æ¨¡å‹ç±», ...)
</div></code></pre>
</li>
<li>
<p>å¤–é”®ç±»ForeignKey</p>
<ul>
<li>æ„é€ å‡½æ•°:<pre class="hljs"><code><div>ForeignKey(to, on_delete, **options)
</div></code></pre>
</li>
<li>å¸¸ç”¨å‚æ•°:
<ul>
<li>on_delete
<ol>
<li>models.CASCADE  çº§è”åˆ é™¤ã€‚ Djangoæ¨¡æ‹ŸSQLçº¦æŸON DELETE CASCADEçš„è¡Œä¸ºï¼Œå¹¶åˆ é™¤åŒ…å«ForeignKeyçš„å¯¹è±¡ã€‚</li>
<li>models.PROTECT æŠ›å‡ºProtectedError ä»¥é˜»æ­¢è¢«å¼•ç”¨å¯¹è±¡çš„åˆ é™¤;</li>
<li>SET_NULL è®¾ç½®ForeignKey nullï¼›åªæœ‰nullæ˜¯Trueæ‰æœ‰å¯èƒ½ã€‚</li>
<li>SET_DEFAULT  å°†ForeignKeyè®¾ç½®ä¸ºå…¶é»˜è®¤å€¼ï¼›å¿…é¡»è®¾ç½®ForeignKeyçš„é»˜è®¤å€¼ã€‚</li>
<li>... å…¶å®ƒå‚è¯·å‚è€ƒæ–‡æ¡£ <a href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#foreignkey">https://docs.djangoproject.com/en/1.11/ref/models/fields/#foreignkey</a> ForeignKeyéƒ¨åˆ†</li>
</ol>
</li>
<li><code>**options</code> å¯ä»¥æ˜¯å¸¸ç”¨çš„å­—æ®µé€‰é¡¹å¦‚:
<ol>
<li>null</li>
<li>uniqueç­‰</li>
<li>...</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
<ul>
<li>æœ‰äºŒä¸ªå‡ºç‰ˆç¤¾å¯¹åº”äº”æœ¬ä¹¦çš„æƒ…å†µ.
<ol>
<li>
<p><code>æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾</code> æœ‰ä¹¦</p>
<ol>
<li>C++</li>
<li>Java</li>
<li>Python</li>
</ol>
</li>
<li>
<p><code>åŒ—äº¬å¤§å­¦å‡ºç‰ˆç¤¾</code> æœ‰ä¹¦</p>
<ol>
<li>è¥¿æ¸¸è®°</li>
<li>æ°´æµ’</li>
</ol>
</li>
</ol>
</li>
</ul>
<ol>
<li>å®šä¹‰ä¸€å¯¹å¤šç±»<pre class="hljs"><code><div><span class="hljs-comment"># file: myorm/models.py</span>
<span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Publisher</span><span class="hljs-params">(models.Model)</span>:</span>
    <span class="hljs-string">'''å‡ºç‰ˆç¤¾'''</span>
    name = models.CharField(<span class="hljs-string">'åç§°'</span>, max_length=<span class="hljs-number">50</span>, unique=<span class="hljs-keyword">True</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(<span class="hljs-string">'ä¹¦å'</span>, max_length=<span class="hljs-number">50</span>)
    publisher = models.ForeignKey(Publisher, null=<span class="hljs-keyword">True</span>)

</div></code></pre>
</li>
</ol>
<ul>
<li>
<p>åˆ›å»ºä¸€å¯¹å¤šçš„å¯¹è±¡</p>
<pre class="hljs"><code><div><span class="hljs-comment"># file: xxxxx/views.py</span>
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> models
pub1 = models.Publisher.objects.create(name=<span class="hljs-string">'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'</span>)
models.Book.objects.create(title=<span class="hljs-string">'C++'</span>, publisher=pub1)
models.Book.objects.create(title=<span class="hljs-string">'Java'</span>, publisher=pub1)
models.Book.objects.create(title=<span class="hljs-string">'Python'</span>, publisher=pub1)

pub2 = models.Publisher.objects.create(name=<span class="hljs-string">'åŒ—äº¬å¤§å­¦å‡ºç‰ˆç¤¾'</span>)
models.Book.objects.create(title=<span class="hljs-string">'è¥¿æ¸¸è®°'</span>, publisher=pub2)
models.Book.objects.create(title=<span class="hljs-string">'æ°´æµ’'</span>, publisher=pub2)
</div></code></pre>
</li>
<li>
<p>æŸ¥è¯¢:</p>
<ul>
<li>é€šè¿‡å¤šæŸ¥ä¸€</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># é€šè¿‡ä¸€æœ¬ä¹¦æ‰¾åˆ°å¯¹åº”çš„å‡ºç‰ˆç¤¾</span>
abook = models.Book.objects.get(id=<span class="hljs-number">1</span>)
print(abook.title, <span class="hljs-string">'çš„å‡ºç‰ˆç¤¾æ˜¯:'</span>, abook.publisher.name)
</div></code></pre>
<ul>
<li>é€šè¿‡ä¸€æŸ¥å¤š</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># é€šè¿‡å‡ºç‰ˆç¤¾æŸ¥è¯¢å¯¹åº”çš„ä¹¦</span>
pub1 = models.Publisher.objects.get(name=<span class="hljs-string">'æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾'</span>)
books = pub1.book_set.all()  <span class="hljs-comment"># é€šè¿‡book_set è·å–pub1å¯¹åº”çš„å¤šä¸ªBookæ•°æ®å¯¹è±¡</span>
<span class="hljs-comment"># books = models.Book.objects.filter(publisher=pub1)  # ä¹Ÿå¯ä»¥é‡‡ç”¨æ­¤æ–¹å¼è·å–</span>
print(<span class="hljs-string">"æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾çš„ä¹¦æœ‰:"</span>)
<span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:
    print(book.title)
</div></code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>ç»ƒä¹ :
<ol>
<li>å®ŒæˆBook å’Œ Publisher ä¹‹é—´çš„ä¸€å¯¹å¤š</li>
<li>æŸ¥çœ‹æ•°æ®åº“æ•ˆæœ</li>
<li>ç™»å½•åˆ°åå°,æŸ¥çœ‹Bookå®ä½“</li>
</ol>
</li>
</ul>
<ol start="3">
<li>æ•°æ®æŸ¥è¯¢
<ol>
<li>é€šè¿‡ Book æŸ¥è¯¢ Publisher<pre class="hljs"><code><div>é€šè¿‡ publisher å±æ€§æŸ¥è¯¢å³å¯
ç»ƒä¹ :
    æŸ¥è¯¢ è¥¿æ¸¸è®° å¯¹åº”çš„å‡ºç‰ˆç¤¾ä¿¡æ¯,æ‰“å°åœ¨ç»ˆç«¯ä¸Š
</div></code></pre>
</li>
<li>é€šè¿‡ Publisher æŸ¥è¯¢ å¯¹åº”çš„æ‰€æœ‰çš„ Books<pre class="hljs"><code><div>Djangoä¼šåœ¨Publisherä¸­å¢åŠ ä¸€ä¸ªå±æ€§æ¥è¡¨ç¤ºå¯¹å¯¹åº”çš„Bookä»¬çš„æŸ¥è¯¢å¼•ç”¨
å±æ€§:book_set(MyModel.objects)
</div></code></pre>
</li>
</ol>
</li>
</ol>
<h4 id="%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84">å¤šå¯¹å¤šæ˜ å°„</h4>
<ul>
<li>å¤šå¯¹å¤šè¡¨è¾¾å¯¹è±¡ä¹‹é—´å¤šå¯¹å¤šå¤æ‚å…³ç³»ï¼Œå¦‚: æ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„å­¦æ ¡(å°å­¦ï¼Œåˆä¸­ï¼Œé«˜ä¸­,...),æ¯ä¸ªå­¦æ ¡éƒ½æœ‰ä¸åŒçš„å­¦ç”Ÿ...</li>
</ul>
<ol>
<li>
<p>è¯­æ³•</p>
<pre class="hljs"><code><div>åœ¨å…³è”çš„ä¸¤ä¸ªç±»ä¸­çš„ä»»æ„ä¸€ä¸ªç±»ä¸­,å¢åŠ :
å±æ€§ = models.ManyToManyField(MyModel)
</div></code></pre>
</li>
<li>
<p>ç¤ºä¾‹</p>
<pre class="hljs"><code><div>ä¸€ä¸ªä½œè€…å¯ä»¥å‡ºç‰ˆå¤šæœ¬å›¾ä¹¦
ä¸€æœ¬å›¾ä¹¦å¯ä»¥è¢«å¤šåä½œè€…åŒæ—¶ç¼–å†™

class Author(models.Model):
    xxxx xxxx

class Book(models.Model):
    xxxx xxxx

    authors = models.ManyToManyField(Author)
</div></code></pre>
</li>
<li>
<p>æ•°æ®æŸ¥è¯¢</p>
<ol>
<li>é€šè¿‡ Book æŸ¥è¯¢å¯¹åº”çš„æ‰€æœ‰çš„ Authors<pre class="hljs"><code><div>å¯ä»¥é€šè¿‡authorsè¡¨ç¤ºå¯¹åº”æ‰€æœ‰Authorçš„æŸ¥è¯¢å¯¹è±¡

book.authors.all() -&gt; è·å– book å¯¹åº”çš„æ‰€æœ‰çš„authorçš„ä¿¡æ¯

book.authors.filter(age__gt=80) -&gt; è·å–bookå¯¹åº”çš„ä½œè€…ä¸­å¹´é¾„å¤§äº80å²çš„ä½œè€…çš„ä¿¡æ¯
</div></code></pre>
</li>
<li>é€šè¿‡ Author æŸ¥è¯¢å¯¹åº”çš„æ‰€æœ‰çš„Books<pre class="hljs"><code><div>Djangoä¼šç”Ÿæˆä¸€ä¸ªå±æ€§ book_set ç”¨äºè¡¨ç¤ºå¯¹å¯¹åº”çš„bookçš„æŸ¥è¯¢å¯¹è±¡ç›¸å…³æ“ä½œ
author.book_set.all()
author.book_set.filter()
author.book_set.create(...)  # åˆ›å»ºæ–°ä¹¦å¹¶è”ä½œç”¨author
author.book_set.add(book)   # æ·»åŠ å·²æœ‰çš„ä¹¦ä¸ºå½“å‰ä½œè€…author
author.book_set.clear()  # åˆ é™¤authoræ‰€æœ‰å¹¶è”çš„ä¹¦
author.book_set.remove()  # åˆ é™¤æ‰€authoræ‰€æœ‰å¹¶è”çš„ä¹¦
</div></code></pre>
</li>
</ol>
</li>
<li>
<p>ç¤ºä¾‹:</p>
<ul>
<li>å¤šå¯¹å¤šæ¨¡å‹</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Author</span><span class="hljs-params">(models.Model)</span>:</span>
    <span class="hljs-string">'''ä½œå®¶æ¨¡å‹ç±»'''</span>
    name = models.CharField(<span class="hljs-string">'ä½œå®¶'</span>, max_length=<span class="hljs-number">50</span>)
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(<span class="hljs-string">'ä¹¦å'</span>, max_length=<span class="hljs-number">50</span>)
    author = models.ManyToManyField(Author, null=<span class="hljs-keyword">True</span>)
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title
</div></code></pre>
<ul>
<li>å¤šå¯¹å¤šè§†å›¾æ“ä½œ</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse

<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> models

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">many2many_init</span><span class="hljs-params">(request)</span>:</span>
    <span class="hljs-comment"># åˆ›å»ºä¸¤äººä¸ªä½œè€…</span>
    author1 = models.Author.objects.create(name=<span class="hljs-string">'å•æ³½'</span>)
    author2 = models.Author.objects.create(name=<span class="hljs-string">'é­è€å¸ˆ'</span>)

    <span class="hljs-comment"># å•æ‹©å’Œé­è€å¸ˆåŒæ—¶å†™äº†ä¸€æœ¬Python</span>
    book11 = author1.book_set.create(title=<span class="hljs-string">"Python"</span>)
    author2.book_set.add(book11)  <span class="hljs-comment">#</span>

    <span class="hljs-comment"># é­è€å¸ˆè¿˜å†™äº†ä¸¤æœ¬ä¹¦</span>
    book21 = author2.book_set.create(title=<span class="hljs-string">"C"</span>)  <span class="hljs-comment"># åˆ›å»ºä¸€æœ¬æ–°ä¹¦"C"</span>
    book22 = author2.book_set.create(title=<span class="hljs-string">"C++"</span>)  <span class="hljs-comment"># åˆ›å»ºä¸€æœ¬æ–°ä¹¦"C++"</span>

    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">"åˆå§‹åŒ–æˆåŠŸ"</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_many2many</span><span class="hljs-params">(request)</span>:</span>
    authors = models.Author.objects.all()
    <span class="hljs-keyword">for</span> auth <span class="hljs-keyword">in</span> authors:
        print(<span class="hljs-string">"ä½œè€…:"</span>, auth.name, <span class="hljs-string">'å‘å‡ºç‰ˆäº†'</span>, auth.book_set.count(), <span class="hljs-string">'æœ¬ä¹¦: '</span>)
        <span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:
            print(<span class="hljs-string">'    '</span>, book.title)
    print(<span class="hljs-string">"----æ˜¾ç¤ºä¹¦å’Œä½œè€…çš„å…³ç³»----"</span>)
    books = models.Book.objects.all()
    <span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:
        auths = book.author.all()
        print(book.title, <span class="hljs-string">'çš„ä½œè€…æ˜¯:'</span>, <span class="hljs-string">'ã€'</span>.join([str(x.name) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> auths]))
    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">"æ˜¾ç¤ºæˆåŠŸï¼Œè¯·æŸ¥çœ‹æœåŠ¡å™¨ç«¯æ§åˆ¶å°ç»ˆç«¯"</span>)
</div></code></pre>
<ul>
<li>å¤šå¯¹å¤šæœ€ç»ˆçš„SQLç»“æœ</li>
</ul>
<pre class="hljs"><code><div>mysql&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> myorm2_author;
+<span class="hljs-comment">----+-----------+</span>
| id | name      |
+<span class="hljs-comment">----+-----------+</span>
| 11 | å•æ³½      |
| 12 | é­è€å¸ˆ    |
+<span class="hljs-comment">----+-----------+</span>
2 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)

mysql&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> myorm2_book;
+<span class="hljs-comment">----+--------+</span>
| id | title  |
+<span class="hljs-comment">----+--------+</span>
| 13 | Python |
| 14 | C      |
| 15 | C++    |
+<span class="hljs-comment">----+--------+</span>
3 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)

mysql&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> myorm2_book_author;
+<span class="hljs-comment">----+---------+-----------+</span>
| id | book_id | author_id |
+<span class="hljs-comment">----+---------+-----------+</span>
| 17 |      13 |        11 |
| 20 |      13 |        12 |
| 18 |      14 |        12 |
| 19 |      15 |        12 |
+<span class="hljs-comment">----+---------+-----------+</span>
4 rows in <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)
</div></code></pre>
<ul>
<li>ç¤ºä¾‹ç¤ºæ„å›¾
<img src="images/manytomany.png" alt=""></li>
</ul>
</li>
</ol>

</body>
</html>
